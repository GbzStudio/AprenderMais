<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AprenderMais — Cursos Gratuitos</title>
<meta name="description" content="Página inicial — AprenderMais. Encontre cursos gratuitos, pesquise, filtre e acesse o painel de criar cursos (requer login).">
<style>
  /* ================= THEME: azul-neon / futurista ================= */
  :root{
    --bg:#040617; --panel:#071224; --card:#081426; --muted:#93a3b9;
    --accent:#4f46e5; --accent2:#06b6d4; --glass:rgba(255,255,255,0.03);
    --radius:14px; --maxw:1300px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter, system-ui, Arial, sans-serif;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(6,22,40,0.45), transparent),
                linear-gradient(180deg,#020416 0%, #041025 100%);
    color:#e6eef8; -webkit-font-smoothing:antialiased; padding:22px;
  }
  .wrap{max-width:var(--maxw);margin:0 auto}
  header{display:flex;align-items:center;gap:14px;padding:12px;border-radius:12px;background:linear-gradient(90deg, rgba(10,16,32,0.28), rgba(6,14,20,0.28));backdrop-filter:blur(6px)}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent2),var(--accent));display:flex;align-items:center;justify-content:center;font-weight:900}
  h1{margin:0;font-size:18px}
  .tagline{color:var(--muted);font-size:13px}
  nav.top{margin-left:auto;display:flex;gap:8px;align-items:center}
  .btn{background:linear-gradient(90deg,var(--accent2),var(--accent));border:none;color:white;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .btn.small{padding:6px 8px;font-size:13px;border-radius:8px}
  .searchbar{display:flex;gap:10px;align-items:center;margin-top:18px}
  .input{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:10px;border-radius:10px;color:inherit;width:100%}
  .filters{display:flex;gap:8px;align-items:center}

  /* main layout */
  .controls{display:flex;justify-content:space-between;align-items:center;margin-top:18px;gap:12px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:18px;margin-top:18px}
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03);
    transition:transform .22s,box-shadow .22s; transform-style:preserve-3d;
  }
  .card:hover{transform:translateY(-8px) scale(1.01);box-shadow:0 20px 50px rgba(2,6,23,0.6)}
  .thumb{height:140px;border-radius:10px;overflow:hidden;background:#061124;border:1px solid rgba(255,255,255,0.02)}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .course-title{font-weight:800;margin-top:10px}
  .course-desc{color:var(--muted);font-size:13px;margin-top:6px}
  .meta{display:flex;gap:8px;align-items:center;margin-top:10px}
  .pill{background:rgba(255,255,255,0.02);color:var(--muted);padding:6px 10px;border-radius:999px;font-size:13px}

  /* user card */
  .user{display:flex;gap:8px;align-items:center}
  .avatar{width:40px;height:40px;border-radius:999px;overflow:hidden;background:#0e1720;border:1px solid rgba(255,255,255,0.03)}
  .avatar img{width:100%;height:100%;object-fit:cover}

  footer{margin-top:22px;text-align:center;color:var(--muted);font-size:13px}

  @media(max-width:760px){
    .controls{flex-direction:column;align-items:stretch}
    .searchbar{flex-direction:column;align-items:stretch}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">AM</div>
      <div>
        <h1>AprenderMais</h1>
        <div class="tagline">Cursos grátis — pesquise, filtre e aprenda</div>
      </div>

      <nav class="top" aria-label="Navegação">
        <a class="btn ghost" href="criar.html">Criar Curso</a>
        <a class="btn ghost" href="sobre.html">Mais Sites</a>
        <div id="userBlock" class="user" style="display:none">
          <div class="avatar" id="userAvatar"><img alt="avatar"/></div>
          <div>
            <div id="userName" style="font-weight:700"></div>
            <div id="userEmail" style="font-size:12px;color:var(--muted)"></div>
          </div>
          <button id="btnLogout" class="btn small" style="margin-left:12px">Sair</button>
        </div>
        <button id="btnLogin" class="btn small">Entrar</button>
      </nav>
    </header>

    <div class="searchbar" role="search">
      <input id="q" class="input" placeholder="Pesquisar cursos por nome..." />
      <div class="filters">
        <select id="filterNivel" class="input" style="width:160px">
          <option value="">Todos os níveis</option>
          <option>Iniciante</option>
          <option>Intermediário</option>
          <option>Avançado</option>
        </select>
        <select id="sortBy" class="input" style="width:160px">
          <option value="new">Mais recentes</option>
          <option value="old">Mais antigos</option>
          <option value="name">A → Z</option>
        </select>
        <button id="clearFilters" class="btn ghost small">Limpar</button>
      </div>
    </div>

    <div class="controls">
      <div class="small muted" id="stats">Carregando cursos…</div>
      <div>
        <button id="btnRefresh" class="btn small">Atualizar</button>
      </div>
    </div>

    <main>
      <section id="coursesGrid" class="grid" aria-live="polite"></section>
      <div id="noResults" style="margin-top:12px;color:var(--muted);display:none">Nenhum curso encontrado.</div>
    </main>

    <footer>
      © <strong>AprenderMais</strong> — cursos gratuitos • Feito por GbzStudio
    </footer>
  </div>

  <!-- Firebase compat libs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

  <script>
  /*
    index.html — moderno (grade)
    - Exibe nome e foto do usuário logado (via Firebase Auth)
    - Busca, filtro por nível e ordenação
    - Lazy-load de imagens
    - Botão criar leva a criar.html
  */

  const firebaseConfig = {
    apiKey: "AIzaSyALpPt-tUWB0Gq-UeJXOJRRkyt0si8s4Nc",
    authDomain: "fir-auth-3521c.firebaseapp.com",
    databaseURL: "https://fir-auth-3521c-default-rtdb.firebaseio.com",
    projectId: "fir-auth-3521c",
    storageBucket: "fir-auth-3521c.firebasestorage.app",
    messagingSenderId: "873308453565",
    appId: "1:873308453565:web:4ff8d9863adb1eae1c95d4",
    measurementId: "G-LWMZJ55W7N"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth(), db = firebase.database();

  // Elements
  const coursesGrid = document.getElementById('coursesGrid');
  const qInput = document.getElementById('q');
  const filterNivel = document.getElementById('filterNivel');
  const sortBy = document.getElementById('sortBy');
  const clearFilters = document.getElementById('clearFilters');
  const btnRefresh = document.getElementById('btnRefresh');
  const stats = document.getElementById('stats');
  const noResults = document.getElementById('noResults');

  // user UI
  const btnLogin = document.getElementById('btnLogin');
  const userBlock = document.getElementById('userBlock');
  const userAvatar = document.getElementById('userAvatar');
  const userName = document.getElementById('userName');
  const userEmail = document.getElementById('userEmail');
  const btnLogout = document.getElementById('btnLogout');

  let coursesCache = [];
  let observer = null;

  function toast(msg, t=2000){
    const d = document.createElement('div'); d.textContent = msg;
    d.style.cssText = "position:fixed;right:18px;bottom:18px;background:#081425;color:#e6eef8;padding:10px 14px;border-radius:10px;z-index:9999;border:1px solid rgba(255,255,255,0.04)";
    document.body.appendChild(d); setTimeout(()=>d.style.opacity='0', t); setTimeout(()=>d.remove(), t+300);
  }

  function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[ch]); }
  function truncate(s,n=140){ if(!s) return ''; return s.length>n? s.slice(0,n-1)+'…': s; }

  // lazy load observer for images
  function initObserver(){
    if (observer) observer.disconnect();
    observer = new IntersectionObserver(entries=>{
      entries.forEach(e=>{
        if (e.isIntersecting){
          const img = e.target;
          if (img.dataset && img.dataset.src){
            img.src = img.dataset.src;
            img.onload = ()=> img.style.opacity = '1';
            img.removeAttribute('data-src');
          }
          observer.unobserve(img);
        }
      });
    }, { rootMargin: '200px', threshold: 0.1 });
  }

  // render courses
  function renderCourses(list){
    coursesGrid.innerHTML = '';
    if (!list.length){ noResults.style.display = 'block'; stats.textContent = '0 cursos encontrados'; return; }
    noResults.style.display = 'none';
    stats.textContent = `${list.length} cursos • exibindo em grade`;
    initObserver();
    list.forEach(c=>{
      const card = document.createElement('article'); card.className = 'card';
      const thumbHtml = c.thumbnailUrl ? `<div class="thumb"><img data-src="${c.thumbnailUrl}" alt="${escapeHtml(c.nome)}"></div>` : `<div class="thumb"><div style="padding:14px;color:var(--muted)">Sem imagem</div></div>`;
      card.innerHTML = `
        ${thumbHtml}
        <div class="course-title">${escapeHtml(c.nome)}</div>
        <div class="course-desc">${escapeHtml(truncate(c.descricao,140))}</div>
        <div class="meta">
          <div class="pill">${c.nivel || '—'}</div>
          <div class="pill">${(c.tags||[]).slice(0,3).join(', ')}</div>
          <div style="margin-left:auto;color:var(--muted);font-size:13px">Criado: ${new Date(c.createdAt||0).toLocaleDateString()}</div>
        </div>
      `;
      coursesGrid.appendChild(card);
      // observe image
      const img = card.querySelector('img[data-src]');
      if (img) observer.observe(img);
    });
  }

  // load from firebase
  function loadCourses(){
    stats.textContent = 'Carregando cursos…';
    db.ref('cursos').once('value').then(snap=>{
      const arr = [];
      snap.forEach(child => {
        const c = child.val();
        c._id = child.key;
        c.tags = c.tags || [];
        arr.push(c);
      });
      coursesCache = arr;
      applyFiltersAndRender();
    }).catch(err=>{
      console.error('Erro ao carregar cursos', err);
      stats.textContent = 'Erro ao carregar cursos';
    });
  }

  // filters & sort
  function applyFiltersAndRender(){
    let list = coursesCache.slice();

    const q = (qInput.value||'').trim().toLowerCase();
    if (q){
      list = list.filter(c => (c.nome||'').toLowerCase().includes(q) || (c.descricao||'').toLowerCase().includes(q) || (c.tags||[]).join(' ').toLowerCase().includes(q));
    }
    const nivel = (filterNivel.value||'').trim();
    if (nivel) list = list.filter(c => (c.nivel||'') === nivel);
    const s = sortBy.value;
    if (s === 'new') list.sort((a,b)=> (b.createdAt||0)-(a.createdAt||0));
    else if (s === 'old') list.sort((a,b)=> (a.createdAt||0)-(b.createdAt||0));
    else if (s === 'name') list.sort((a,b)=> (a.nome||'').localeCompare(b.nome||''));
    renderCourses(list);
  }

  // event listeners
  qInput.addEventListener('input', debounce(()=> applyFiltersAndRender(), 220));
  filterNivel.addEventListener('change', applyFiltersAndRender);
  sortBy.addEventListener('change', applyFiltersAndRender);
  clearFilters.addEventListener('click', ()=>{
    qInput.value=''; filterNivel.value=''; sortBy.value='new'; applyFiltersAndRender();
  });
  btnRefresh.addEventListener('click', loadCourses);

  // auth UI
  btnLogin.addEventListener('click', ()=> { window.location.href = 'criar.html'; });

  btnLogout.addEventListener('click', async ()=> {
    try{ await auth.signOut(); toast('Desconectado'); location.reload(); } catch(e){ toast('Erro ao sair'); }
  });

  // show user info when logged
  auth.onAuthStateChanged(user=>{
    if (user && !user.isAnonymous){
      userBlock.style.display = 'flex';
      userName.textContent = user.displayName || user.email || ('uid:' + user.uid);
      userEmail.textContent = user.email || '';
      const photo = user.photoURL || '';
      const imgEl = userAvatar.querySelector('img');
      if (photo) imgEl.src = photo;
      else imgEl.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80"><rect width="100%" height="100%" fill="%230b1220"/><text x="50%" y="55%" font-size="30" fill="%2394a3b8" text-anchor="middle" font-family="Arial">U</text></svg>';
      btnLogin.style.display = 'none';
    } else {
      userBlock.style.display = 'none';
      btnLogin.style.display = 'inline-block';
      // try anonymous sign-in for read-only
      if (!auth.currentUser) auth.signInAnonymously().catch(()=>{});
    }
  });

  // small helpers
  function debounce(fn, ms=200){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; }

  // init
  (function init(){
    initObserver();
    loadCourses();
    // optionally refresh every X seconds (disabled by default)
    // setInterval(loadCourses, 60*1000);
  })();
  </script>
</body>
</html>
